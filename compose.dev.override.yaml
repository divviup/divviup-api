# Overrides for the local development docker compose setup. Meant only to be used by
# compose.dev.yaml

x-build: &build
  build:
    context: .
    args:
      RUST_PROFILE: dev
      # We don't need both of these features in all three services, but it allows reusing one
      # container image for both this and the divviup_api service.
      RUST_FEATURES: integration-testing,admin

services:
  divviup_api:
    image: !reset null
    <<: *build
    develop:
      watch:
        - path: src/
          action: rebuild

  divviup_api_migrate:
    image: !reset null
    <<: *build
    develop:
      watch:
        - path: migration
          action: rebuild
          ignore:
            - README.md

  pair_aggregator:
    image: !reset null
    <<: *build
    develop:
      watch:
        - path: cli/
          action: rebuild
        - path: client/
          action: rebuild
